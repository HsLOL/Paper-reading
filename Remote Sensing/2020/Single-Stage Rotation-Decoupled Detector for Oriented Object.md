#### Single-Stage Rotation-Decoupled Detector for Oriented Object

源码获取位置： https://github.com/Capino512/pytorch-rotation-decoupled-detector

* 针对倾斜交并比对角度变化敏感（宽高比大的物体）对这个角度变化更加敏感的问题，提出将旋转真值解耦，并用不同朝向的水平框去回归的解决方案。
* 分类损失上对不同作用的锚框采用不同的标签解决正负样本不均衡问题，对锚框，真值标记的坐标位置也有所改变

> 自己对为什么要关注倾斜交并比对角度变化敏感问题的理解：

> 一个检测器的检测性能与检测器能否通过生成的锚框将真值目标找到，有着非常大甚至直接的关系。
>
> 由于遥感图像中目标方向任意，目前大多数的方法都是生成几种固定角度的锚框对真值目标进行召回，但是这就需要解决**判断真值能否被锚框召回的倾斜交并比对角度变化敏感**的问题，也就是即使有一个生成的锚框离真值很近，但由于角度变化了一点点就使倾斜交并比剧烈下降到设定的阈值之下，使得真值无法被生成的锚框召回而导致漏检的现象发生，所以就有很多论文围绕锚框如何对真值进行匹配来做。

#### 一、旋转锚框

（1）旋转锚框的表示方法

* 主要思路就是用两种不同方向锚框（竖直和水平）加一个角度参数（范围是-45°— 45°）来表示所有旋转锚框。

将生成的水平锚框按照锚框的朝向分为水平方向和竖直方向分为两种类型，两种类型的锚框具有相同的中心点和形状，然后根据真值所处的位置不同，用不同类型的锚框去匹配它，下图。
$$
HBB_h和HBB_v
$$
![image-20210517124258748](C:\Users\fzh\AppData\Roaming\Typora\typora-user-images\image-20210517124258748.png)

图中左面绿色锚框HBBv负责预测绿色扇形内的真值标注，图中右面蓝色锚框HBBh负责预测蓝色扇形内的真值标注。

（2）锚框的设置

由于也是用水平锚框+角度参数来表示旋转锚框，文章采用SSD里的锚框尺寸设置方法来匹配不同形状的物体。对于DOTA数据集锚框尺度大小和宽高比的设置
$$
scale:{2^0,2^{1/3},2^{1/3}}\\
ratio:{1,2,1/2,4,1/4,8,1/8}
$$
（3）锚框与真值的匹配策略

![image-20210517153325625](C:\Users\fzh\AppData\Roaming\Typora\typora-user-images\image-20210517153325625.png)

展示了匹配策略的一部分，图中上面是每隔30°生成的旋转锚框用来对真值进行召回，这种方式存在某些角度会使旋转IoU降低。

下面是论文中提出的匹配策略。对于\theta范围（指的是真值标注）在[0°,45°]之间，用HBBh锚框进行召回；\theta范围在(45°,90°]之间，用HBBv锚框进行召回。

实验也表明，用这种方式不会受到锚框与真值由于角度的关系而使IoU剧烈变化，同时正类锚框数量也比较稳定。

![image-20210517154009247](C:\Users\fzh\AppData\Roaming\Typora\typora-user-images\image-20210517154009247.png)

#### 二、损失函数

（1）分类损失函数：

对正类锚框，负类锚框，不参与训练的锚框标记为1，0,-1，采用 如下的损失函数。

![image-20210517154127796](C:\Users\fzh\AppData\Roaming\Typora\typora-user-images\image-20210517154127796.png)

（2）回归损失函数：

![image-20210517154216595](C:\Users\fzh\AppData\Roaming\Typora\typora-user-images\image-20210517154216595.png)

#### 三、数据集

对原始的DOTA图片裁剪为{512, 768, 1024, 1536}大小，然后缩放到768*768（感觉用的是EfficientDet-D3网络)，输入到网络中。

